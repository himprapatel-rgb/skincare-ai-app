stages:
  - build
  - test
  - deploy

build_app:
  stage: build
  script:
    - echo "Building iOS and Android apps..."
    - flutter pub get
    - flutter build ios --release
    - flutter build apk --release
  artifacts:
    paths:
      - build/ios/app.ipa
      - build/android/app-release.apk
    expire_in: 1 week
  only:
    - main

test_app:
  stage: test
  script:
    - echo "Running tests..."
    - flutter test --coverage
  only:
    - main

deploy_app:
  stage: deploy
  script:
    - echo "==================================="
    - echo "âœ… DEPLOYMENT APPROVAL REQUIRED"
    - echo "Project: $CI_PROJECT_NAME"
    - echo "Branch: $CI_COMMIT_REF_NAME"
    - echo ""
    - echo "ðŸ“¦ Build artifacts ready:"
    - echo "  â€¢ iOS: build/ios/app.ipa"
    - echo "  â€¢ Android: build/android/app-release.apk"
    - echo "Status: PRODUCTION READY"
    - echo "==================================="
  when: manual
  only:
    - main
